---
layout: default
title: Gophercloud
---

<div class="row">
	<div class="col-md-6">
    <h3>Try it!</h3>
    <p>To see if Gophercloud works with your favorite provider, simply execute these commands at your Bash or compatible shell prompt:</p>
    <pre>mkdir test-gophercloud && cd test-gophercloud
export GOPATH=$(pwd)
go get github.com/rackspace/gophercloud
export OS_AUTH_URL=$URL_TO_PROVIDER_IDENTITY_V2.0_ENDPOINT
export OS_USERNAME=$YOUR_ACCOUNT_USERNAME
export OS_PASSWORD=$YOUR_ACCOUNT_PASSWORD
go test -tags acceptance github.com/rackspace/gophercloud
</pre>
    <p>If the tests pass, congratulations!  Gophercloud should work fine with your provider.</p>
	</div>
	<div class="col-md-6">
    <h3>Looking for Developer Documentation?</h3>
    <p>We try to follow Go community best practices as much as we can.  This includes providing usable documentation in the form of "go docs."  We strive to keep every function, type, and package documented and current.  <a href="http://godoc.org/github.com/rackspace/gophercloud">You can review our godocs here.</a>
	</div>
</div>
<div class="row">
  <div class="col-md-6">
    <h3>Example: Authenticating With Identity V2</h3>
    <p><b>NOTE:</b> The following code comes from the acceptance tests of our up-coming v0.2.0 API.</p>
    <p>The follow example illustrates how to authenticate against Openstack's Identity API, inspect the returned authentication token, and display useful information from the returned service catalog.  The code has been edited to better fit the web format.</p>
    <pre>func TestAuthentication(t *testing.T) {
	// Create an initialized set of authentication options
	// based on available OS_* environment variables.
	ao, err := utils.AuthOptions()
	if err != nil {
		t.Error(err)
		return
	}

	// Attempt to authenticate with them.
	r, err := identity.Authenticate(ao)
	if err != nil {
		t.Error(err)
		return
	}

	// We're authenticated; now let's grab our authen-
	// tication token.
	tok, err := identity.GetToken(r)
	if err != nil {
		t.Error(err)
		return
	}

	// Authentication tokens have a variety of fields which
	// might be of some interest.  Let's print a few of them out.

	table := map[string]string{
		"ID":      tok.Id,
		"Expires": tok.Expires,
	}

	for attr, val := range table {
		fmt.Printf("Your token's %s is %s\n", attr, val)
	}

	// With each authentication, you receive a master dir-
	// ectory of all the services your account can access.
	// This "service catalog", as OpenStack calls it, pro-
	// vides you the means to exploit other OpenStack ser-
	// vices.
	sc, err := identity.GetServiceCatalog(r)
	if err != nil {
		t.Error(err)
		return
	}

	// Prepare our elastic tabstopped writer for our table.
	w := new(tabwriter.Writer)
	w.Init(os.Stdout, 2, 8, 2, ' ', 0)

	// Different providers will provide different services.
	// Let's print them in summary.
	ces, err := sc.CatalogEntries()
	fmt.Println("Service Catalog Summary:")
	fmt.Fprintln(w, "Name\tType\t")
	for _, ce := range ces {
		fmt.Fprintf(w, "%s\t%s\t\n", ce.Name, ce.Type)
	}
	w.Flush()

	// Now let's print them in greater detail.
	for _, ce := range ces {
		fmt.Printf("Endpoints for %s/%s\n", ce.Name, ce.Type)
		fmt.Fprintln(w, "Version\tRegion\tTenant\tPublic URL\tInternal URL\t")
		for _, ep := range ce.Endpoints {
			fmt.Fprintf(w, "%s\t%s\t%s\t%s\t%s\t\n", ep.VersionId, ep.Region, ep.TenantId, ep.PublicURL, ep.InternalURL)
		}
		w.Flush()
	}
}</pre>
  </div>
  <div class="col-md-6">
    <h3>Example: Creating and Destroying Servers</h3>
    <p><b>NOTE:</b> The following code comes from the acceptance tests of our up-coming v0.2.0 API.</p>
    <p>The following example illustrates how to create and destroy a server using Openstack's Compute API.
    Note that we depend on utility functions which we don't list here, so that we may focus on the server-related calls.
    We edited the code to better fit the web format.</p>
    <pre>func TestCreateDestroyServer(t *testing.T) {
	// Initialize our test state (ts) structure based on
	// available environment variable settings.
	ts, err := setupForCRUD()
	if err != nil {
		t.Error(err)
		return
	}

	// First, we need to pick a random name for it.
	ts.serverName = randomString("ACPTTEST", 16)
	fmt.Printf("Attempting to create server: %s\n", ts.serverName)

	// We have a valid endpoint to use thanks to
	// setupForCRUD(), above.  Let's instantiate a client
	// on that endpoint.
	ts.client = servers.NewClient(ts.ep, ts.a, ts.o)

	// Now we can request the server be created.
	// We assume ts.flavorId and ts.imageId were set up
	// via setupForCRUD().
	cr, err := servers.Create(ts.client, map[string]interface{}{
		"flavorRef": ts.flavorId,
		"imageRef":  ts.imageId,
		"name":      ts.serverName,
	})
	if err != nil {
		return err
	}

	// The server returned by the Create endpoint will
	// only give a small synopsis of the full set of
	// information.  To get more detailed info about
	// the server, you should call the GetDetail() method.
	// However, to do that, we need to know the server
	// ID.
	//
	// Unfortunately, the data returned above is opaque;
	// it's stored effectively as a raw blob of data.
	// We need to decode it into a more structured form,
	// to access fields like Id.
	ts.createdServer, err = servers.GetServer(cr)

	// Remember to delete the server when we're done using
	// it.
	//
	// We put this in a defer so that it gets executed even
	// in the face of errors or panics.
	defer func() {
		servers.Delete(ts.client, ts.createdServer.Id)
	}()

	// Wait for the server provisioning to complete.
	err = waitForStatus(ts, "ACTIVE")
	if err != nil {
		t.Error(err)
	}

	// At this point, you're free to use the server how-
	// ever you wish.
}</pre>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
    <h3>Example: Waiting for Server Provisioning to Finish</h3>
    <p><b>NOTE:</b> The following code comes from the acceptance tests of our up-coming v0.2.0 API.</p>
<pre>// waitForStatus waits up to 5 minutes (estimated)
// for a server to reach ACTIVE status.
func waitForStatus(ts *testState, s string) error {
	var (
		inProgress bool
		timeout    int
		err        error
	)

	for inProgress, timeout, err = countDown(ts, 300); inProgress; inProgress, timeout, err = countDown(ts, timeout) {
		if ts.createdServer.Status == s {
			fmt.Printf("Server created after %d seconds (approximately)\n", 300-timeout)
			break
		}
	}

	if err == errTimeout {
		fmt.Printf("Timeout -- I'm not waiting around.\n")
		err = nil
	}

	return err
}

// countDown implements a simple state machine to im-
// plement a crude countdown timer.
func countDown(ts *testState, timeout int) (bool, int, error) {
	if timeout & lt; 1 {
		return false, 0, errTimeout
	}
	time.Sleep(1 * time.Second)
	timeout--

	gr, err := servers.GetDetail(ts.client, ts.createdServer.Id)
	if err != nil {
		return false, timeout, err
	}

	ts.createdServer, err = servers.GetServer(gr)
	if err != nil {
		return false, timeout, err
	}

	return true, timeout, nil
}
</pre>
  </div>
</div>
